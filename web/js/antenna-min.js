function getClientWidth(){return"CSS1Compat"!==document.compatMode||window.opera?document.body.clientWidth:document.documentElement.clientWidth}function getClientHeight(){return"CSS1Compat"!==document.compatMode||window.opera?document.body.clientHeight:document.documentElement.clientHeight}function getInternetExplorerVersion(){if("Microsoft Internet Explorer"===navigator.appName){var a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})");if(null!==b.exec(a))return parseFloat(RegExp.$1)}return-1}function r_line(a,b,c,d,e){return a.path("M"+b+" "+c+"L"+d+" "+e)}function radians(a){return Math.PI*a/180}function degrees(a){return 180*(a/Math.PI)}function fontSize(a){return{"font-size":a}}function fontWeight(a){return{"font-weight":a}}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),Array.prototype.maxIndex||(Array.prototype.maxIndex=function(){if(!this.length)return-1;for(var a=0,b=this.length,c=1;b>c;++c)this[a]<this[c]&&(a=c);return a}),Array.prototype.minIndex||(Array.prototype.minIndex=function(){if(!this.length)return-1;for(var a=0,b=this.length,c=1;b>c;++c)this[a]>this[c]&&(a=c);return a}),Array.prototype.maxValue||(Array.prototype.maxValue=function(){return this.length?this[this.maxIndex()]:void 0}),Array.prototype.minValue||(Array.prototype.minValue=function(){return this.length?this[this.minIndex()]:void 0});var antennaGeometry=function(a,b,c,d,e,f,g,h,i){var N,k=Raphael(a,b,c),l=void 0,m=Math.min,n=Math.max,o=Matrix.RotationX(radians(15)).x(Matrix.RotationY(radians(-60)).x($M([[0,1,0],[0,0,1],[1,0,0]]))),q=f?f:0,r=g?g:0,s=l,t=h?14:0,u=0,v=0,w=-1!==getInternetExplorerVersion(),x="#fff",y="#f8f8f8",z=1,A=2,B=function(a){return Math.round(1e3*a)+"mm"},C=function(a){return Math.round(1e4*a)/10},D=function(a){return Math.round(1e4*a)/10+"mm"},E=function(a){return a%2?[a,16]:(a/=2,a%2?[a,8]:(a/=2,a%2?[a,4]:(a/=2,[a,2])))},F=function(a){var c,d,b=0>a?-Math.round(a/.0015875):Math.round(a/.0015875);return 0!==b%16?(c=Math.abs(b%16),d=E(c),(0>a?"-":"")+Math.round(b/16-.5)+" "+d[0]+"/"+d[1]+" in"):(0>a?"-":"")+Math.round(b/16-.5)+"in"},G=function(a){var c,d,b=0>a?-Math.round(a/.0015875):Math.round(a/.0015875);return 0!==b%16?(c=Math.abs(b%16),d=E(c),(0>a?"-":"")+Math.round(b/16-.5)+" "+d[0]+"/"+d[1]):(0>a?"-":"")+Math.round(b/16-.5)},H=function(a){var d,e,f,h,i,j,k,b=0,c=[];for(b=0;b!==a.length;b++)for(d=a[b][0],e=a[b].slice(1),0!==e.length%6&&alert("Invalid geometry array - length="+e.length),f=0;f!==e.length;f+=6)h=$V(e.slice(f,f+3)),i=$V(e.slice(f+3,f+6)),j=h.subtract(i),k=j.modulus(),c.push({color:d,pts:[h,i],selected:0,sselected:0,eselected:0,len:k,names:[[B(k),C(h.e(1))+","+C(h.e(2))+","+C(h.e(3)),C(i.e(1))+","+C(i.e(2))+","+C(i.e(3))],[F(k),G(h.e(1))+","+G(h.e(2))+","+G(h.e(3)),G(i.e(1))+","+G(i.e(2))+","+G(i.e(3))]]});return c},I=function(a,b){var d,e,f,g,h,c=[];for(d=0;d!=a.length;++d)e=a[d],f=e.pts[0].x(b),g=e.pts[1].x(b),h=e.len*b,c.push({color:e.color,pts:[f,g],selected:0,sselected:0,eselected:0,len:h,names:[[B(h),C(f.e(1))+","+C(f.e(2))+","+C(f.e(3)),C(g.e(1))+","+C(g.e(2))+","+C(g.e(3))],[F(h),G(f.e(1))+","+G(f.e(2))+","+G(f.e(3)),G(g.e(1))+","+G(g.e(2))+","+G(g.e(3))]]});return c},J=H(e),K=[],L=-1,M=[],O=$V([b/2+q,(c+t)/2+r,0]),P=$V([0,0,0]),Q=this,R=$M([[1,0,0],[0,-1,0],[0,0,1]]),S=R.x(o),U=function(a,e,f){if(0!==a||0!==e){if(0===u==!f)O=O.add($V([a,-e,0]));else{var h,g=0;if("z"==s?(g=-e,a=0,e=0):"y"==s?a=0:"x"==s&&(e=0),0===a&&0===e&&0===g)return;h=Math.sqrt(a*a+e*e+g*g)*Math.PI/m(b,c),rot=Matrix.Rotation(h,$V([-e,a,g]).toUnitVector()),h=o.x(P).x(d),O=O.add(R.x(h).subtract(R.x(rot.x(h)))),o=rot.x(o)}Q.redraw()}},V=function(a){var b=S.x(P);O=O.add(b.x(d).subtract(b.x(d*a))),d*=a,Q.redraw()},W=k.set(),X=k.set(),Y=null,Z=null,$=null,bb="#b00",cb="#0b0",db="#00b",eb="#ccc",hb="none",jb="#8ff",lb=function(){var a=S.x(Vector.Zero(3)).x(30).add(O),b=S.x(Vector.i).x(30).add(O),c=a.e(1),d=a.e(2),e=b.e(1),f=b.e(2);X.push(r_line(k,c,d,e,f).attr({stroke:bb,stroke_width:1})),e=c+1.25*(e-c),f=d+1.25*(f-d),X.push(k.text(e,f,"X").attr({stroke:bb,stroke_width:1})),b=S.x(Vector.j).x(30).add(O),e=b.e(1),f=b.e(2),X.push(r_line(k,c,d,e,f).attr({stroke:cb,stroke_width:1})),e=c+1.25*(e-c),f=d+1.25*(f-d),X.push(k.text(e,f,"Y").attr({stroke:cb,stroke_width:1})),b=S.x(Vector.k).x(30).add(O),e=b.e(1),f=b.e(2),X.push(r_line(k,c,d,e,f).attr({stroke:db,stroke_width:1})),e=c+1.25*(e-c),f=d+1.25*(f-d),X.push(k.text(e,f,"Z").attr({stroke:db,stroke_width:1}))},mb=function(){L=this.i,xb(),null!=Y&&Y.remove(),Q.redraw(),pb(),wb()},nb=function(a,b,c,d,e,f){var g=k.set(),h=k.rect(1,1,b,c+2,2),i=k.text(b/2,c/2+1,a).attr(fontSize(c));return h.attr({fill:e&&e()?jb:f,stroke:hb}),h.click(function(){d(),h.attr({fill:e&&e()?jb:f})}),h.mouseover(function(){this.attr({fill:eb})}),h.mouseout(function(){this.attr({fill:e&&e()?jb:f})}),i.click(function(){d(),h.attr({fill:e&&e()?jb:f})}),i.mouseover(function(){h.attr({fill:eb}),this.attr(fontWeight("bold"))}),i.mouseout(function(){h.attr({fill:e&&e()?jb:f}),this.attr(fontWeight("normal"))}),g.push(h),g.push(i),g.rect=h,g},ob=function(){$=nb("Help",30,11,function(){window.open("http://clients.teksavvy.com/~nickm/help.html")},0,y),$.translate(b-30,0)},pb=function(){if(K.length){var c,d,e,f,a=i.length;for(c=0;c!==K.length;++c)a+=K[c][0].length;for(null==Y&&(Y=k.set()),f=m((b-20)/(a+K.length+1),8),start=(b-f*a)/2-30,Y.push(k.text(start+i.length*f/2,t/2,i).attr(fontSize(11))),start+=(1+i.length)*f,c=0;c!==K.length;++c)c===L?Y.push(k.rect(start,1,K[c][0].length*f,t-2).attr({fill:jb,stroke:hb})):(e=k.rect(start,1,K[c][0].length*f,t-2),e.attr({fill:y,stroke:hb}),e.mouseover(function(){this.attr({fill:eb})}),e.mouseout(function(){this.attr({fill:gbcolor})}),e.click(mb),e.i=c,Y.push(e)),d=k.text(start+K[c][0].length*f/2,t/2,K[c][0]).attr(fontSize(11)),Y.push(d),c!==L&&(d.i=c,d.click(mb),d.rect=e,d.mouseover(function(){this.rect.attr({fill:eb}),this.attr(fontWeight("bold"))}),d.mouseout(function(){this.rect.attr({fill:x}),this.attr(fontWeight("normal"))})),start+=(1+K[c][0].length)*f}},qb=function(a,b){return Math.atan2(a.cross(b).modulus(),a.dot(b))},rb=function(a,b){var c=[a.pts[0].subtract(b.pts[0]).modulus(),a.pts[0].subtract(b.pts[1]).modulus(),a.pts[1].subtract(b.pts[0]).modulus(),a.pts[1].subtract(b.pts[1]).modulus()];return mini=c.minIndex(),ang=0,0==mini&&(ang=qb(a.pts[1].subtract(a.pts[0]),b.pts[1].subtract(b.pts[0]))),1==mini&&(ang=qb(a.pts[1].subtract(a.pts[0]),b.pts[0].subtract(b.pts[1]))),2==mini&&(ang=qb(a.pts[0].subtract(a.pts[1]),b.pts[1].subtract(b.pts[0]))),3==mini&&(ang=qb(a.pts[0].subtract(a.pts[1]),b.pts[0].subtract(b.pts[1]))),Math.round(10*degrees(ang))/10+"\xb0"},sb=[],tb=0,ub=[$V([1e8,1e8,1e8]),$V([-1e8,-1e8,-1e8])],vb=function(){var a=ub[1].subtract(ub[0]),e=m((b-40)/n(1,a.e(1)),(c-80)/n(1,a.e(2))),f=ub[1].add(ub[0]).x(.5);P=S.inv().x(f.subtract(O).x(1/d)),d*=e,O=$V([b/2,c/2,0]).subtract(f.subtract(O).x(e))},wb=function(){var f,m,n,o,p,q,a=v?F:D,c=0,d=[],e=[],g=[],h=[],i=[],j="",l=0;if(!sb.length)return Z=k.text(b/2-20,t+7,"Select elements for info. Double click to clear. Total len: "+a(tb)).attr(fontSize(11)),void 0;for(f=0;f!==sb.length;++f)m=sb[f],n=m[0],o=m[1],p=m[2],q=M[n][o],0===p?(e.push(q),d.push(q.pts[0]),d.push(q.pts[1]),c+=q.len):d.push(q.pts[p-1]);for(f=0;f!==d.length;++f)-1===g.indexOf(d[f].e(1))&&g.push(d[f].e(1)),-1===h.indexOf(d[f].e(2))&&h.push(d[f].e(2)),-1===i.indexOf(d[f].e(3))&&i.push(d[f].e(3));1===g.length?(j+=" x: "+a(g[0]),++l):2===g.length&&(j+=" \u0394x: "+a(Math.abs(g[0]-g[1])),++l),1===h.length?(j+=" y: "+a(h[0]),++l):2===h.length&&(j+=" \u0394y: "+a(Math.abs(h[0]-h[1])),++l),1===i.length?(j+=" z: "+a(i[0]),++l):2===i.length&&(j+=" \u0394z: "+a(Math.abs(i[0]-i[1])),++l),2==e.length&&3>l&&(j+=" \u2221"+rb(e[0],e[1]),++l),c>0&&(j+=" Total len: "+a(c),++l),Z=k.text(b/2-20,t+7,"Selection info ("+sb.length+"): "+j).attr(fontSize(11))},xb=function(){var a,b,c;for(sb=[],Z.remove(),a=0;a!==M.length;++a)for(c=M[a],b=0;b!==c.length;++b)c[b].selected=0,c[b].sselected=0,c[b].eselected=0},yb=function(){W.remove(),W.push(k.g.popup(this.x,this.y,this.value,null,3))},zb=function(){W.remove()},Ab=function(){var a=this.si;M[a[0]][a[1]].selected=!M[a[0]][a[1]].selected,Z.remove(),Q.redraw(),wb()},Bb=function(){var a=this.si;M[a[0]][a[1]].sselected=!M[a[0]][a[1]].sselected,Z.remove(),Q.redraw(),wb()},Cb=function(){var a=this.si;M[a[0]][a[1]].eselected=!M[a[0]][a[1]].eselected,Z.remove(),Q.redraw(),wb()},Db=function(a,b,c,d,e,f){var g=function(a,b){var c={},d={};return(a==l?d:c).fill=a,(b==l?d:c).stroke=b,c};return b=b||a,b==a&&(b.attr({fill:d,stroke:f}),b.fillin=c,b.fillout=d,b.strokein=e,b.strokeout=f),a.hover(function(){b.attr(g(b.fillin,b.strokein))},function(){b.attr(g(b.fillout,b.strokeout))}),a},Eb=function(){u=u?0:1;var b=this.btn||this;b.fillout=u?jb:y,b.attr({fill:b.fillout}),Q.redraw()},Fb=function(){var n,p,q,r,s,a="#888",d="#ccc",e="#000",f="none",h={fill:x,"stroke-dasharray":"-","stroke-width":1},i={fill:x,"stroke-width":2,"fill-opacity":.75},j={fill:x,"stroke-width":.5,"stroke-dasharray":"-"},m={fill:"none","stroke-width":2,"fill-opacity":.5};s=nb("mm",20,13,function(){r.rect.attr({fill:y}),v=0,Z.remove(),wb()},function(){return!v},y),s.translate(0,c-40),r=nb("in",20,13,function(){s.rect.attr({fill:y}),v=1,Z.remove(),wb()},function(){return v},y),r.translate(0,c-20),q=k.set(),q.push(k.path("M0,3l15,-3l9,5l-15,3z").attr(i)),q.push(k.path("M0,3l9,5v16l-9,-5z").attr(i)),q.push(k.path("M9,8v16l15,-3v-16z").attr(i)),Db(q,l,a,x).click(function(){o=Matrix.RotationX(radians(15)).x(Matrix.RotationY(radians(-60)).x($M([[0,1,0],[0,0,1],[1,0,0]]))),Q.redraw()}),q.translate(b-206,c-28).attr({stroke:"#000","stroke-linejoin":"round"}),q=k.set(),q.push(k.path("M0,24l8,-8v-16m0,16h16").attr(h)),q.push(Db(k.path("M0,8v16h16v-16z").attr(i),l,a,x).click(function(){o=$M([[0,1,0],[0,0,1],[1,0,0]]),Q.redraw()})),q.push(Db(k.path("M0,8h16l8,-8h-16z").attr(i),l,a,x).click(function(){o=$M([[0,1,0],[-1,0,0],[0,0,1]]),Q.redraw()})),q.push(Db(k.path("M16,8v16l8,-8v-16z").attr(i),l,a,x).click(function(){o=$M([[-1,0,0],[0,0,1],[0,1,0]]),Q.redraw()})),q.translate(b-178,c-28).attr({stroke:"#000","stroke-linejoin":"round"}),q=k.set(),q.push(Db(k.path("M0,8v16l8,-8v-16z").attr(j),l,d,x).click(function(){o=$M([[1,0,0],[0,0,1],[0,-1,0]]),Q.redraw()})),q.push(Db(k.path("M0,24h16l8,-8h-16z").attr(j),l,d,x).click(function(){o=$M([[0,1,0],[1,0,0],[0,0,-1]]),Q.redraw()})),q.push(Db(k.path("M8,0h16v16h-16z").attr(j),l,d,x).click(function(){o=$M([[0,-1,0],[0,0,1],[-1,0,0]]),Q.redraw()})),q.push(k.path("M0,8v16h16v-16z").attr(m)),q.push(k.path("M0,8h16l8,-8h-16z").attr(m)),q.push(k.path("M16,8v16l8,-8v-16z").attr(m)),q.translate(b-150,c-28).attr({stroke:"#000","stroke-linejoin":"round"}),n=k.circle(b-122+16,c-15,14).click(function(){V(1.1)}),Db(n,n,eb,y,f,f),p=k.path("M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM15.687,9.051h-4v2.833H8.854v4.001h2.833v2.833h4v-2.834h2.832v-3.999h-2.833V9.051z").attr({fill:e,stroke:f}).translate(b-122,c-30).click(function(){V(1.1)}),Db(p,n),n=k.circle(b-93+16,c-15,14).click(function(){V(1/1.1)}),p=k.path("M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM8.854,11.884v4.001l9.665-0.001v-3.999L8.854,11.884z").attr({fill:e,stroke:f}).translate(b-93,c-30).click(function(){V(1/1.1)}),Db(n,n,eb,y,f,f),Db(p,n),rotate_btn=k.set(),n=k.circle(16,16,14),Db(n,n,eb,y,e,e),rotate_btn.push(n),n.click(Eb),p=k.path("M15.999,4.308c1.229,0.001,2.403,0.214,3.515,0.57L18.634,6.4h6.247l-1.562-2.706L21.758,0.99l-0.822,1.425c-1.54-0.563-3.2-0.878-4.936-0.878c-7.991,0-14.468,6.477-14.468,14.468c0,3.317,1.128,6.364,3.005,8.805l2.2-1.689c-1.518-1.973-2.431-4.435-2.436-7.115C4.312,9.545,9.539,4.318,15.999,4.308zM27.463,7.203l-2.2,1.69c1.518,1.972,2.431,4.433,2.435,7.114c-0.011,6.46-5.238,11.687-11.698,11.698c-1.145-0.002-2.24-0.188-3.284-0.499l0.828-1.432H7.297l1.561,2.704l1.562,2.707l0.871-1.511c1.477,0.514,3.058,0.801,4.709,0.802c7.992-0.002,14.468-6.479,14.47-14.47C30.468,12.689,29.339,9.643,27.463,7.203z").attr({fill:"#000"}).scale(.75),rotate_btn.push(p),p.btn=n,p.click(Eb),Db(p,n),rotate_btn.translate(b-32,c-32),fit_btn=k.set(),n=k.circle(15.5,15.5,14),Db(n,n,eb,y,e,e),fit_btn.push(n),fit_btn.push(p=k.path("M25.545,23.328,17.918,15.623,25.534,8.007,27.391,9.864,29.649,1.436,21.222,3.694,23.058,5.53,15.455,13.134,7.942,5.543,9.809,3.696,1.393,1.394,3.608,9.833,5.456,8.005,12.98,15.608,5.465,23.123,3.609,21.268,1.351,29.695,9.779,27.438,7.941,25.6,15.443,18.098,23.057,25.791,21.19,27.638,29.606,29.939,27.393,21.5z").attr({fill:"#000",stroke:"#000"}).scale(5/8)),Db(p,n),fit_btn.translate(b-64,c-32).click(function(){vb(),Q.redraw()}),q=k.set(),n=k.rect(1,1,30,11).attr({stroke:f}).click(function(){z=5,Q.redraw()}),Db(n,n,eb,y),p=r_line(k,3,6,29,6).attr({stroke:e,"stroke-width":5}).click(function(){z=5,Q.redraw()}),Db(p,n,eb,y),q.push(p),q.push(n),n=k.rect(1,12,30,11).attr({stroke:f}).click(function(){z=3,Q.redraw()}),Db(n,n,eb,y),p=r_line(k,3,18,29,18).attr({stroke:e,"stroke-width":3}).click(function(){z=3,Q.redraw()}),Db(p,n,eb,y),q.push(p),q.push(n),n=k.rect(1,23,30,11).attr({stroke:f}).click(function(){z=1,Q.redraw()}),Db(n,n,eb,y),p=r_line(k,3,29,29,29).attr({stroke:e,"stroke-width":1}).click(function(){z=1,Q.redraw()}),Db(p,n,eb,y),q.push(p),q.push(n),n=k.circle(40,7,6).attr({stroke:f}).click(function(){A=4,Q.redraw()}),Db(n,n,eb,y),p=k.circle(40,7,4).attr({fill:e}).click(function(){A=4,Q.redraw()}),Db(p,n,eb,y),q.push(p),q.push(n),n=k.circle(40,18,6).attr({stroke:f}).click(function(){A=3,Q.redraw()}),Db(n,n,eb,y),p=k.circle(40,18,3).attr({fill:e}).click(function(){A=3,Q.redraw()}),Db(p,n,eb,y),q.push(p),q.push(n),n=k.circle(40,29,6).attr({stroke:f}).click(function(){A=2,Q.redraw()}),Db(n,n,eb,y),p=k.circle(40,29,2).attr({fill:e}).click(function(){A=2,Q.redraw()}),Db(p,n,eb,y),q.push(p),q.push(n),q.translate(30,c-40)},Gb=function(a,b){return $V([m(a.e(1),b.e(1)),m(a.e(2),b.e(2)),m(a.e(3),b.e(3))])},Hb=function(a,b){return $V([n(a.e(1),b.e(1)),n(a.e(2),b.e(2)),n(a.e(3),b.e(3))])},Ib=0,Kb=function(a,b){return a.z-b.z},Lb=function(a,b,c,d,e,f,g){var h,i,j=k.rect(a,b,c,d,e).attr({fill:g,stroke:"none"});j.drag(function(a,b){var c=a-h,d=-b+i;h=a,i=b,U(c,d,j.mb)},function(a,b,c){s=f,h=0,i=0,j.mb=void 0==c.which?4==c.button:2==c.which,Ib=1},function(){Ib=0,Q.redraw()}),j.dblclick(function(){xb(),Q.redraw(),wb()})},Mb=function(a){return"[object Array]"===Object.prototype.toString.call(a)};if(k.g=k.g||k,h)for(L=0,N=0;N!==h.length;++N)Mb(h[N][1])?K.push([h[N][0],H(h[N][1])]):K.push([h[N][0],I(J,h[N][1])]);Lb(1,1,b-2,c-2,10,"3",x),Lb(1,1,b-2,40,10,"x",y),Lb(1,1,40,c-2,10,"z",y),Lb(b-41,1,b-2,c-2,10,"y",y),Lb(1,c-42,b-2,c-2,10,"x",y),Fb(),ob(),pb(),this.redraw=function(){W.remove(),X.remove();var e,f,j,l,n,p,q,r,s,a=v?1:0,b=[],c=0,t=k.set(),u=k.set(),y={},B={};for(tb=0,Ib||(sb=[]),M=[J],-1!==L&&(Mb(h[L][1])?M.push(K[L][1]):M=[K[L][1]]),ub=[$V([1e8,1e8,1e8]),$V([-1e8,-1e8,-1e8])],S=R.x(o),c=0;c!==M.length;++c)for(f=M[c],e=0;e!==f.length;e++)j=f[e],tb+=j.len,s={z:0,s:S.x(j.pts[0]).x(d).add(O),e:S.x(j.pts[1]).x(d).add(O),sindex:[c,e]},s.z=m(s.s.e(3),s.e.e(3)),b.push(s),ub[0]=Gb(Gb(ub[0],s.s),s.e),ub[1]=Hb(Hb(ub[1],s.s),s.e);if(Ib||b.sort(Kb),!Ib&&!w&&11>z){for(X.push(t),X.push(u),c=0;c!==b.length;++c)j=b[c],l="M"+j.s.e(1)+" "+j.s.e(2)+"L"+j.e.e(1)+" "+j.e.e(2),n=j.sindex,p=k.path(l),t.push(p),f=M[n[0]],e=n[1],p.value=f[e].names[a][0],p.x=(j.s.e(1)+j.e.e(1))/2,p.y=(j.s.e(2)+j.e.e(2))/2,p.si=n,p.hover(yb,zb),p.click(Ab),s=k.circle(j.s.e(1),j.s.e(2),7),u.push(s),s.value=f[e].names[a][1],s.x=j.s.e(1),s.y=j.s.e(2),s.si=n,s.hover(yb,zb),s.click(Bb),s=k.circle(j.e.e(1),j.e.e(2),7),u.push(s),s.value=f[e].names[a][2],s.x=j.e.e(1),s.y=j.e.e(2),s.si=n,s.hover(yb,zb),s.click(Cb);t.attr({stroke:x,"stroke-width":11,"fill-opacity":0,"stroke-opacity":0}),u.attr({stroke:x,fill:x,"fill-opacity":0,"stroke-opacity":0})}for(lb(),Ib&&(j=S.x(P).x(d).add(O),X.push(k.circle(j.e(1),j.e(2),6).attr({stroke:"#f0f",fill:"#f0f"}))),c=0;c!==b.length;++c)j=b[c],l="M"+j.s.e(1)+" "+j.s.e(2)+"L"+j.e.e(1)+" "+j.e.e(2),n=j.sindex,e=n[1],f=M[n[0]],q=f[e].color,r=f[e].selected?"#f0f":q,p=k.path(l),r in y||(y[r]=k.set(),X.push(y[r])),y[r].push(p),Ib||(p.value=f[e].names[a][0],p.x=(j.s.e(1)+j.e.e(1))/2,p.y=(j.s.e(2)+j.e.e(2))/2,p.si=n,f[e].selected&&sb.push([n[0],e,0]),p.hover(yb,zb),p.click(Ab),r=f[e].sselected?"#f0f":q,s=k.circle(j.s.e(1),j.s.e(2),A),r in B||(B[r]=k.set(),X.push(B[r])),B[r].push(s),s.value=f[e].names[a][1],s.x=j.s.e(1),s.y=j.s.e(2),s.si=n,f[e].sselected&&sb.push([n[0],e,1]),s.hover(yb,zb),s.click(Bb),r=f[e].eselected?"#f0f":q,s=k.circle(j.e.e(1),j.e.e(2),A),r in B||(B[r]=k.set(),X.push(B[r])),B[r].push(s),s.value=f[e].names[a][2],s.x=j.e.e(1),s.y=j.e.e(2),s.si=n,f[e].eselected&&sb.push([n[0],e,2]),s.hover(yb,zb),s.click(Cb));for(prop in y)y[prop].attr({stroke:prop,"stroke-width":z});for(prop in B)B[prop].attr({stroke:prop,fill:prop})},this.redraw(),this.fit=function(){vb()},wb()},gainChart=function(a,b,c,d,e,f,g,h,i,j){var m,o,p,q,r,s,t,u,v,k=Raphael(a,b+40,c+40+10*Math.max(e.length,f.length)),l=k.set(),w="#ccc",x="#000",y=function(){l&&l.remove(),l.push(k.g.popup(this.x,this.y,this.value,null,3))},z=function(){l&&l.remove()},A=function(){this.hidden?(this.hidden=0,this.text.attr({fill:x}),this.chart.lines.show(),this.chart.symbols.show(),this.chart.dots.show()):(this.hidden=1,this.text.attr({fill:w}),this.chart.lines.hide(),this.chart.symbols.hide(),this.chart.dots.hide())};for(j&&k.text(b/2,10,j).attr(fontSize(14)),k.g.txtattr.font="10px 'Fontin Sans', Fontin-Sans, sans-serif",m=e.length;0!==m;)--m,o=e[m][0],p=e[m][1],q=f[m][1],r=e[m].slice(2),r.length&&(s=m?{gutter:10,nostroke:!1,axis:"0 0 0 0",symbol:"o",smooth:!0,axisystep:2*(h-g),axisxstep:d.length-1,axisymin:g,axisymax:h,dash:""}:{gutter:10,nostroke:!1,axis:"0 0 1 1",symbol:"o",smooth:!0,axisystep:2*(h-g),axisxstep:d.length-1,axisymin:g,axisymax:h,grid:"5 2",dash:""},r.length>d.length&&(r=r.slice(0,d.length)),t=k.g.linechart(20,20,b,c,[d],[r],s).hover(y,z),t.symbols.attr({r:2}),t.lines.attr({stroke:p}),t.symbols.attr({stroke:p}),t.symbols.attr({fill:p}),t.grid.attr({"stroke-width":.25}),v=k.rect(20,c+31+10*m,20,8).attr({stroke:"none",fill:p}),v.chart=t,v.hidden=0,v.color=p,v.altcolor=q,v.mouseover(function(){this.attr({fill:this.altcolor}),this.text.attr(fontWeight("bold"))}),v.mouseout(function(){this.attr({fill:this.color}),this.text.attr(fontWeight("normal"))}),v.text=k.text(44,c+35+10*m,o).attr({"text-anchor":"start"}),v.text.rect=v,v.text.mouseover(function(){this.rect.attr({fill:this.rect.altcolor}),this.attr(fontWeight("bold"))}),v.text.mouseout(function(){this.rect.attr({fill:this.rect.color}),this.attr(fontWeight("normal"))}),v.text.text=v.text,v.text.chart=v.chart,v.click(A),v.text.click(A));for(m=f.length;0!==m;)--m,o=f[m][0],p=f[m][1],q=e[m][1],r=f[m].slice(2),r.length&&(s=m?{gutter:10,nostroke:!1,axis:"0 0 0 0",symbol:"o",smooth:!0,axisystep:2*(i-1),axisxstep:d.length-1,axisymin:1,axisymax:i,dash:""}:{gutter:10,nostroke:!1,axis:"0 1 0 0",symbol:"o",smooth:!0,axisystep:2*(i-1),axisxstep:d.length-1,axisymin:1,axisymax:i,grid:"0 1",dash:""},r.length>d.length&&(r=r.slice(0,d.length)),u=k.g.linechart(20,20,b,c,[d],[r],s).hover(y,z),u.symbols.attr({r:2}),u.lines.attr({stroke:p}),u.symbols.attr({stroke:p}),u.symbols.attr({fill:p}),u.axis.attr({stroke:"#f00"}),u.grid.attr({stroke:"#f00"}),u.grid.attr({"stroke-width":.25}),v=k.rect(b,c+31+10*m,20,8).attr({stroke:"none",fill:p}),v.chart=u,v.hidden=0,v.color=p,v.altcolor=q,v.mouseover(function(){this.attr({fill:this.altcolor}),this.text.attr(fontWeight("bold"))}),v.mouseout(function(){this.attr({fill:this.color}),this.text.attr(fontWeight("normal"))}),v.text=k.text(b-4,c+35+10*m,o).attr({"text-anchor":"end",fill:"#000"}),v.text.rect=v,v.text.mouseover(function(){this.rect.attr({fill:this.rect.altcolor}),this.attr(fontWeight("bold"))}),v.text.mouseout(function(){this.rect.attr({fill:this.rect.color}),this.attr(fontWeight("normal"))}),v.click(A),v.text.text=v.text,v.text.chart=v.chart,v.text.click(A))},uhf_channels=[14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],uhf_hi_channels=uhf_channels.concat([53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70]),vhf_hi_channels=[7,8,9,10,11,12,13,14],uhfChart=function(a,b,c,d,e,f,g,h,i){return gainChart(a,b,c,uhf_channels,d,e,f,g,h,i)},uhfHiChart=function(a,b,c,d,e,f,g,h,i){return gainChart(a,b,c,uhf_hi_channels,d,e,f,g,h,i)},vhfHiChart=function(a,b,c,d,e,f,g,h,i){return gainChart(a,b,c,vhf_hi_channels,d,e,f,g,h,i)},gainSwrChart=function(a,b,c,d,e,f,g,h,i,j){gainChart(a,b-40,c-40-10*Math.max(e.length,f.length),d,e,f,g,h,i,j)},AntennaHPattern=function(a,b,c,d,e,f,g){b=Math.max(100,b-20),this.x=b/2,this.y=this.x+(d.length>1?20:0);for(var l,m,n,p,s,A,h=this,i=Raphael(a,b,b),j=[],k=0,o=Math.round(b/2-(d.length>1?35:25)),q=[],r=[o],t=[],u=[],v=0,w=360/((d[0][0].length-1)*(e+1)),z=i.set(),C=(Math.min,Math.max);k!=d.length;++k)for(u.push(1),l=0;l!=d[k].length;++l)j.push(d[k][l].maxValue());for(n=C(Math.round(j.minValue()-3.5),0),m=Math.round(j.maxValue()+.5);m>=n;)q.push(m),m-=3;if(m>0&&2>=m)q.push(0);else if(m>0&&5>=m)q.push(m),q.push(0);else if(m>0){for(A=Math.round(m/5),A=Math.round(m/A-.5);m>=A;)q.push(m),m-=A;q.push(0)}else q.length>2&&q.pop(),q.push(0);for(q.push(-5),q.push(-10),q.push(-20),q.push(-50),q.push(-1e3),p=q[0]<=12?.5:6/q[0],s=1-p,k=1;q[k]>0;++k)r.push(Math.round((p+s*q[k]/q[0])*r[0]));r.push(Math.round(p*r[0])),r.push(Math.round(.75*p*r[0])),r.push(Math.round(.5*p*r[0])),r.push(Math.round(.25*p*r[0])),r.push(Math.round(.125*p*r[0])),r.push(0);var D=function(a){var b=1;if(-1e3>a)return 0;for(;b<q.length&&!(a>q[b]);++b);return(r[b-1]-r[b])*(a-q[b])/(q[b-1]-q[b])+r[b]},E=function(){z.remove(),z.push(i.g.popup(this.x,this.y,this.value,null,3))},F=function(){z.remove()},G=function(a){var m,n,o,p,r,b=d[a][v],c=0,f="",j=0,k=0,q=(b[0],i.set()),s=g[a][0],t=function(a){m=D(b[c]),k=radians(j),o=h.x+Math.cos(k)*m,p=h.y-Math.sin(k)*m,f+=a+Math.round(100*o)/100+" "+Math.round(100*p)/100,n=i.circle(o,p,2).attr({stroke:s,fill:s}),n.value=j+" dg\n"+b[c],n.x=o,n.y=p,n.hover(E,F),j+=w,q.push(n)};for(t("M"),r=n,c=1;c<b.length;++c)t("L");if(e)for(c=b.length-2;c>0;--c)t("L");return f+="Z",res=i.path(f),res.attr({stroke:s}).insertBefore(r),q.push(res),q},H=function(){v+=this.step,v>=c.length-1&&(v=c.length-1),h.draw()},I=function(){v-=this.step,0>v&&(v=0),h.draw()},J=function(){var a=this.mno;u[a]?(t[a].hide(),u[a]=0):(t[a].show(),u[a]=1),h.draw()},K=function(){var l,m,n,z,a=0,j=r,k=j.length-5,o=d[0][v],p="#000",s="#888",t="#888",w="#ccc",A="#fff",B="normal",C="bolder",D=function(){var a=this.mno,b=this;b.text.attr(fontWeight(C)),u[a]?b.attr({fill:t}):b.attr({fill:w})},E=function(){var a=this.mno,b=this;b.text.attr(fontWeight(B)),u[a]?b.attr({fill:g[a][1]}):b.attr({fill:A})};if(d.length>1){for(a=0;a!=d.length;++a)o=d[a][v],z=i.rect(a*b/d.length,2,b/d.length,12).attr({stroke:"none"}),z.click(J),z.mno=a,u[a]?z.attr({fill:g[a][1]}):z.attr({fill:A}),z.text=i.text((a+.5)*b/d.length,8,f[a]),z.text.mno=a,z.text.click(J),z.text.btn=z,z.text.mouseover(function(){this.btn.onBtnOver()}),z.text.mouseout(function(){this.btn.onBtnOut()}),z.mouseover(D),z.mouseout(E),z.onBtnOver=D,z.onBtnOut=E,i.text((a+.5)*b/d.length,18,e?"F: "+o[0]+"dBi, B: "+o[o.length-1]+"dBi":"F: "+o[0]+"dBi, B: "+o[Math.round(o.length/2-.5)]+"dBi").attr(fontSize(9)),i.text((a+.5)*b/d.length,28,o.minValue()+" < dBi < "+o.maxValue()).attr(fontSize(9));i.text(8,38,c[v]).attr({"text-anchor":"start"})}else i.text(10,b-18,o.minValue()+" < dBi < "+o.maxValue()).attr({"text-anchor":"start"}),i.text(0,b-8,e?"F: "+o[0]+"dBi, B: "+o[o.length-1]+"dBi":"F: "+o[0]+"dBi, B: "+o[Math.round(o.length/2-.5)]+"dBi").attr({"text-anchor":"start","font-size":9}),i.text(8,8,c[v]).attr({"text-anchor":"start"});for(a=0;a!=j.length-1;++a)i.circle(h.x,h.y,j[a]).attr({stroke:"#000",fill:"none"}),i.text(h.x-10,h.y-j[a]+5,q[a]);for(a=0;360!=a;a+=5)n=radians(a),l=Math.cos(n),m=Math.sin(n),a%15?r_line(i,h.x+l*j[k],h.y+m*j[k],h.x+l*j[0],h.y+m*j[0]).attr({stroke:t}):(a%90?r_line(i,h.x+l*j[k+1],h.y+m*j[k+1],h.x+l*j[0],h.y+m*j[0]).attr({stroke:p}):r_line(i,h.x,h.y,h.x+l*j[0],h.y+m*j[0]).attr({stroke:p}),i.text(h.x+l*(j[0]+10),h.y-m*(j[0]+10),a));x=b-50,y=b-15;var F=function(a,b,c,d,e){var f=i.rect(a,y,b,12),g=i.text(a+b/2,y+5,c);f.attr({fill:s,stroke:"none"}),f.click(d),f.step=e,f.mouseover(function(){this.attr({fill:w}),this.txt.attr(fontWeight("bold"))}),f.mouseout(function(){this.attr({fill:s}),this.txt.attr(fontWeight("normal"))}),f.txt=g,g.attr({fill:s,stroke:p}),g.click(d),g.step=e,g.mouseover(function(){this.rect.attr({fill:w}),this.attr(fontWeight("bold"))}),g.mouseout(function(){this.rect.attr({fill:s}),this.attr(fontWeight("normal"))}),g.rect=f};F(x-16,14,"<",I,1,s),F(x,14,">",H,1),F(x-37,19,"<<",I,5),F(x+16,19,">>",H,5),F(x-53,14,"|<",I,c.length),F(x+37,14,">|",H,c.length)},L=function(){for(var a=0;a!=d.length;++a)t[a]=G(a),u[a]||t[a].hide()};h.draw=function(){i.clear(),K(),L()}},vhfHiFreqTitles=function(){for(var a=0,b=[];8!=a;++a)b.push(174+6*a+" Mhz");return b},uhfFreqTitles=function(){for(var a=0,b=[];39!=a;++a)b.push(470+6*a+" Mhz");return b},uhfHiFreqTitles=function(){for(var a=0,b=[];57!=a;++a)b.push(470+6*a+" Mhz");return b},configureModelPatternTabs=function(){var f,a=$("#show_pattern"),b=$("#show_model"),c=$("#pattern"),d=$("#model"),e="selected",g=function(){$(this).hasClass(e)||(a.toggleClass(e),b.toggleClass(e),a.hasClass(e)?(c.show(),d.hide(),"Loading..."==c.html()&&(f=d.html(),f=f.replace("_r.html","_h.html"),c.html(f))):(d.show(),c.hide()))};a.click(g),b.click(g),c.hide()},configureTabs=function(a){var b=$(a+" a"),c=[],d=[],e=[],f=-1,g="selected",i=function(){var a=0;if(!$(this).hasClass(g))for($(this).toggleClass(g),-1!==f&&(c[f].hide(),e[f].toggleClass(g));a!=e.length;++a)e[a].hasClass(g)&&(f=a,c[f].show(),"Loading..."==c[a].html()&&c[a].html(d[a]))};b.each(function(){var b=$(this),f=b.attr("href");b.attr("title"),b.removeAttr("href"),"#"==f.charAt(0)?(e.length&&$(f).hide(),c.push($(f))):(b.attr("title",""),c.push($(title)),d.push("<object data='"+f+"' style='width:100%; height:100%'></object>"),$(title).html("Loading..."),e.length&&$(title).hide()),e.push(b),b.click(i),b.removeClass(g)}),e.length&&e[0].click()};
